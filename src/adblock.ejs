<!DOCTYPE html>
<html lang="en">
	<%- include('partials/head.ejs',
		{
			page:'adblock',
			title:'Test Ad Block - Toolz',
			description:'Test your ad blocker effectiveness with this comprehensive test. Check how well your ad blocker handles various ad networks, trackers, and analytics services.',
			url: 'd3ward.github.io/toolz/adblock',
			preview_thumbnail:'https://d3ward.github.io/toolz/src/preview_toolz.png',
			keywords:'adblock test,ad block test,ad blocker test,adblock,test adblock,analytics,trackers,ads,cosmetic filter,ublock, ublockorigin,adblock extension,script loading'
		}) %>
	<body>
		<%- include('partials/support_me.ejs') %>
		<%- include('partials/adblock/changelog.ejs') %>
		<%- include('partials/header.ejs', {page:'adblock'}) %>

		<!-- Password protection layer -->
		<div id="password-protection" class="_ta-center" style="display: none;">
			<div class="_pb-1">
				<div class="_bg-gray _radius _p-1 better_r">
					<h1>AdBlock Tester</h1>
					<p>Please enter the password to access the AdBlock tester:</p>
					<div style="margin: 20px 0;">
						<input type="password" id="password-input" placeholder="Enter password" style="padding: 10px; border-radius: 4px; border: 1px solid #ccc; width: 250px; margin-right: 10px;">
						<button id="password-submit" class="btn-primary" style="display: inline-block; padding: 10px 20px; background-color: #3b82f6; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">Submit</button>
					</div>
					<p id="password-error" style="color: #ef4444; display: none;">Incorrect password. Please try again.</p>
				</div>
			</div>
		</div>

		<main id="main-content" style="display: none;">
			<noscript>
				<div class="_bg-red _txt-white _radius _p-1 better_r _py-2 _mt-2">
					<h3>JavaScript is required to run this test. Please enable JavaScript in your browser settings.</h3>
					<style>
						#m_test{
							display: none;
						}
					</style>
				</div>
			</noscript>

			<section id="m_test" class="_mh-100 _py-2">
				<div>
					<div class="_bg-gray _radius _p-1 better_r _mb-1">
						<p>Test your ad blocker's effectiveness against a wide range of advertising, tracking, and analytics domains.</p>
						<button id="start_test" class="btn-primary">Start Test</button>
						<button id="settings_btn" class="btn-secondary">Settings</button>
					</div>
					
					<div id="test_results" class="_bg-white _radius _p-1 better_r _mb-1" style="display: none; background-color: white !important; color: #333333;">
						<h2>Test Results</h2>
						<div class="results-summary">
							<div class="score-container">
								<div id="score_circle" class="score-circle">
									<span id="score_text">0%</span>
								</div>
							</div>
							<div class="results-details">
								<p><strong>Blocked:</strong> <span id="blocked_count">0</span>/<span id="total_count">0</span></p>
								<p><strong>Ad Servers:</strong> <span id="ads_score">0%</span></p>
								<p><strong>Trackers:</strong> <span id="trackers_score">0%</span></p>
								<p><strong>Analytics:</strong> <span id="analytics_score">0%</span></p>
							</div>
						</div>
						<div id="detailed_results" class="detailed-results">
							<!-- Results will be populated here by JavaScript -->
						</div>
					</div>
					
					<div id="test_running" class="_bg-white _radius _p-1 better_r _mb-1" style="display: none;">
						<h2>Testing in progress...</h2>
						<div class="progress-container">
							<div id="progress_bar" class="progress-bar"></div>
						</div>
						<p id="current_test">Preparing tests...</p>
					</div>
				</div>
			</section>
			
			<%- include('partials/adblock/settings.ejs') %>
		</main>
		
		<%- include('partials/footer.ejs') %>
		<%- include('partials/gotop.ejs') %>
		
		<!-- Add test scripts -->
		<script src="js/adblock-test.js" defer></script>
		
		<!-- Authentication Script -->
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				const correctPassword = "ams505";
				const passwordProtection = document.getElementById('password-protection');
				const mainContent = document.getElementById('main-content');
				const passwordInput = document.getElementById('password-input');
				const passwordSubmit = document.getElementById('password-submit');
				const passwordError = document.getElementById('password-error');
				
				// Check if authenticated
				const isAuthenticated = localStorage.getItem('adblock_tester_auth');
				
				if (isAuthenticated === 'true') {
					// User is authenticated, show content
					passwordProtection.style.display = 'none';
					mainContent.style.display = 'block';
				} else {
					// User is not authenticated, show password form
					passwordProtection.style.display = 'block';
					mainContent.style.display = 'none';
					
					// Password verification
					passwordSubmit.addEventListener('click', verifyPassword);
					passwordInput.addEventListener('keypress', function(e) {
						if (e.key === 'Enter') {
							verifyPassword();
						}
					});
				}
				
				function verifyPassword() {
					if (passwordInput.value === correctPassword) {
						// Store authentication in localStorage
						localStorage.setItem('adblock_tester_auth', 'true');
						
						// Show content
						passwordProtection.style.display = 'none';
						mainContent.style.display = 'block';
					} else {
						// Show error
						passwordError.style.display = 'block';
						passwordInput.value = '';
					}
				}
			});
		</script>
	</body>
</html>
